# \[IJCV 2004] SIFT特征

{% embed url="https://dl.acm.org/doi/10.1023/B%3AVISI.0000029664.99615.94" %}

### 检测尺度空间极值

#### 构建尺度空间

SIFT特征在尺度空间中进行搜索，找到对所有尺度都稳定的特征，检测出对图像尺度变化具有不变性的关键点位置。尺度空间唯一可行的线性核是高斯函数，因此，一幅图像尺度空间函数$$L(x,y,\sigma)$$是由尺度可变的高斯函数$$G(x,y,\sigma)$$和输入图像$$I(x,y)$$的卷积生成的：$$L(x,y,\sigma)=G(x,y,\sigma)*I(x,y)$$，而$$G(x,y,\sigma)=\frac{1}{2\pi \sigma^2}e^{-(x^2+y^2)/2\sigma^2}$$.&#x20;

图像尺度是指图像内容的粗细程度，用于模拟观测者距离物体的远近程度。尺度空间描述了不同模糊程度上的特征，没有刻画图像尺寸大小，所以SIFT将尺度空间和图像金字塔结合起来，图像金字塔就是对图像逐步平滑下采样得到的。&#x20;

一般将原图像放大一倍后作为第一层金字塔的第一张图像。

令每一层金字塔(octave)中尺度变化范围为$$\sigma$$，每层金字塔检测s个尺度，那么第t层金字塔的尺度范围就是$$[t\sigma,~(t+1)\sigma]$$。第t+1层金字塔的第一幅图像由上层金字塔中$$(t+1)\sigma$$尺度下倒数第三张图像直接下采样得到，下采样比例为0.5，不需要高斯模糊。同一层金字塔中的图像是在该层金字塔第一层图像的基础上使用高斯模糊产生的，不需要下采样。 尺度金字塔如下：&#x20;

![](../../.gitbook/assets/sift\_0.png)

![](<../../.gitbook/assets/image (255).png>)

这样可以使得金字塔从底部到顶部的尺度是连续的。例如每层金字塔包含3个尺度，即$$s=3, k=2^{1/3}$$，计单位尺度为a，则第一层金字塔最后的尺度为$$2a=k^3a$$，第二层金字塔最先的尺度为$$2ka=k^4a$$.

#### DoG极值

为了在尺度空间中高效地检测出稳定的关键点位置，即尺度空间变化明显的点，计算得到两个相邻的由系数K分离的尺度的差值，也就是在尺度轴上计算梯度：&#x20;

$$D(x,y,\sigma)=(G(x,y,k\sigma)-G(x,y,\sigma))*I(x,y)=L(x,y,k\sigma)-L(x,y,\sigma)$$&#x20;

如下图：&#x20;

![](../../.gitbook/assets/sift\_1.png)

这里DoG近似等于尺度归一化的高斯拉普拉斯算子$$\sigma^2\triangledown G$$，该算子相较于其他角点检测算子能够检测更稳定的图像特征。&#x20;

在DoG空间中寻找极值，要在3D空间的26个相邻点中搜索，如下图：&#x20;

![](../../.gitbook/assets/sift\_2.png)

假设希望在s个尺度上都寻找极值点，那么需要s+2层DoG图像，需要s+3层尺度图像，因此需要在每层金字塔上都计算s+3层尺度图像。

#### 去除噪声

**较小的极值** 为了更加准确地定位关键点的位置，对关键点附近拟合3D二次函数，然后对函数求极值，将每个关键点的一段函数$$D(x,y,\sigma)$$进行泰勒二次展开：&#x20;

&#x20;$$D(x) = D + \frac{\partial D^T}{\partial x} x + \frac{1}{2}x^T\frac{\partial^2D}{\partial x^2} x$$

其中x是相对于关键点的距离，这个展开就是在关键点周围拟合出的3D二次曲线，寻找极值就令其导数为零，于是：&#x20;

![](<../../.gitbook/assets/image (228).png>)

解得：

![](<../../.gitbook/assets/image (286).png>)

此时的极值为：&#x20;

![](../../.gitbook/assets/sift\_5.png)

因此，可以剔除$$|D(\hat{x})|<\frac{0.04}{n}$$的点，n为待提取特征数，这些极值点幅值较小，一般是噪声点。&#x20;

**边缘噪声** 对于blob区域，理想状态是沿任意方向的曲率都较大；而边缘则会沿线方向变化较小，曲率较大，垂直线方向变化较大，曲率较小。对于二维平面，曲面点处的二阶矩矩阵，即Hessian矩阵，刻画了该点周围的变化趋势（其实就是协方差矩阵），Hessian矩阵的特征值对应着在特征向量方向上的投影，特征值越大，函数在该方向上变化趋势越慢，曲率越大。所以说，Hessian矩阵的特征值和特征值所在特征向量方向上的曲率成正比。因此，如果希望使用曲率的比值剔除边缘点，可以通过Hessian矩阵的特征值之间的比值来代替曲率比值。&#x20;

![](../../.gitbook/assets/sift\_6.png)

Hessian矩阵定义为：&#x20;

![](../../.gitbook/assets/sift\_7.png)

可以由二阶差分计算得到。假设Hessian的两个特征值为$$\alpha,\beta$$，则

$$Tr(H)=D_{xx}+D_{yy}=\alpha + \beta, Det(H)=D_{xx}D_{yy}-{(D_{xy})}^2=\alpha\beta$$，

其中Tr为迹，Det为行列式，假设$$\alpha$$为较大的特征值，且$$\alpha=\gamma\beta (\gamma \ge 1)$$，则：&#x20;

![](../../.gitbook/assets/sift\_8.png)

当$$\frac{{Tr}^2(H)}{Det(X)}$$越大，则对应的$$\gamma$$越大，将$$\gamma > \gamma_0=10$$的点剔除掉。

### 关键点的表示

使用三元组$$(x,s,\theta)$$表示关键点，即关键点位置、尺度和方向，使得特征描述子具有旋转不变性。定义样本点梯度的模值和方向为：&#x20;

![](../../.gitbook/assets/sift\_9.png)

关键点的方向是由他周围区域内样本点决定的，比如对4x4区域内所有样本点计算梯度值和方向，将方向分为若干个bin，使用高斯函数加权将周围样本点统计为方向直方图，比如论文中将360°分为36个bin，统计方向落在每个bin中的样本，将该样本点的梯度值乘以高斯权重后加入这个bin，就得到了长度为36的方向直方图，在这个直方图中，最大峰值对应的bin就是关键点的方向。如果存在多个峰值或存在大于0.8倍峰值的bin，则在该点创建多个关键点，这些关键点的位置和尺度一致，但是方向不同。

在论文中，采用的高斯权重函数的尺度为$$\sigma_0=1.5\sigma$$，$$\sigma$$为该关键点所在图像在尺度空间中的尺度，由高斯函数$$3\sigma$$原则，关键点的邻域半径应该设置为$$r=3\sigma_0$$.

### 局部图像描述子

将关键点附近半径为r的邻域（论文中为边长为16的正方形邻域）划分为$$d \times d$$的子区域（论文中推荐d=4），在每个子区域统计长度为h的方向直方图（论文中h=8）,每个直方图被称为一个种子点，这样一个关键点的特征描述子就是一个长度为$$\frac{r^2}{d^2}\times h$$的向量。&#x20;

为了获得旋转不变性，将图像旋转，使关键点的方向统一对齐到图像x轴的方向，采用双线性插值的方法来获得所需要的网格点，然后再对旋转后的图像划分子区域、统计方向直方图。 为了去除光照影响，一般将关键点的特征向量$$H=(h_1,h_2,...,h_{128})$$归一化：$$l_i=\frac{h_i}{\sum_j h^2_j}$$。
